<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é€Ÿç®—é”äºº</title>
    <style>
        /* --- CSS æ¨£å¼ --- */
        body {
            font-family: 'Arial', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background-color: #f0f8ff;
            color: #333;
        }

        .container {
            background: #fff;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            width: 90%;
            max-width: 500px;
            text-align: center;
        }

        h1 {
            color: #007bff;
            margin-bottom: 20px;
        }

        /* é¸æ“‡ä»‹é¢ */
        .selection-panel {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            font-size: 1.1em;
            color: #555;
        }

        select, button.start-btn {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border-radius: 8px;
            border: 1px solid #ccc;
            font-size: 1em;
            box-sizing: border-box;
            cursor: pointer;
        }

        button.start-btn {
            background-color: #28a745;
            color: white;
            border: none;
            font-weight: bold;
            transition: background-color 0.3s;
        }

        button.start-btn:hover {
            background-color: #218838;
        }

        /* éŠæˆ²ä»‹é¢ */
        .game-panel {
            display: none;
        }

        .info-bar {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            font-size: 1.1em;
            font-weight: bold;
        }
        
        #timer {
            color: #dc3545;
        }

        #score {
            color: #007bff;
        }

        .question {
            font-size: 3em;
            margin: 40px 0;
            font-weight: bold;
            color: #007bff;
        }

        .options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .option-btn {
            padding: 15px;
            font-size: 1.5em;
            background-color: #f8f9fa;
            border: 2px solid #007bff;
            border-radius: 10px;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
        }

        .option-btn:hover {
            background-color: #e9ecef;
        }

        /* é–ƒçˆæ•ˆæœ */
        .correct-flash {
            animation: flash-green 0.2s ease-in-out;
            background-color: #28a745 !important; /* ç¶ è‰² */
            color: white;
        }

        .wrong-flash {
            animation: flash-red 0.2s ease-in-out;
            background-color: #dc3545 !important; /* ç´…è‰² */
            color: white;
        }

        @keyframes flash-green {
            0% { background-color: #f8f9fa; color: #333;}
            50% { background-color: #28a745; color: white;}
            100% { background-color: #f8f9fa; color: #333;}
        }

        @keyframes flash-red {
            0% { background-color: #f8f9fa; color: #333;}
            50% { background-color: #dc3545; color: white;}
            100% { background-color: #f8f9fa; color: #333;}
        }
        
        .option-btn:disabled {
            cursor: not-allowed;
            opacity: 0.8;
        }

        /* çµæœä»‹é¢ */
        .result-panel {
            display: none;
        }

        .result-panel h2 {
            color: #28a745;
            margin-bottom: 15px;
        }

        .result-panel p {
            font-size: 1.2em;
            margin-bottom: 20px;
        }

        .restart-btn {
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .restart-btn:hover {
            background-color: #0056b3;
        }

    </style>
</head>
<body>

<div class="container">
    <h1>é€Ÿç®—é”äºº ğŸ§ </h1>

    <div id="selectionPanel" class="selection-panel">
        <label for="gradeSelect">é¸æ“‡å¹´ç´šï¼š</label>
        <select id="gradeSelect">
            <option value="1">ä¸€å¹´ç´š (ä¸€ä½æ•¸åŠ æ¸›)</option>
            <option value="2">äºŒå¹´ç´š (11-20 åŠ æ¸›, ä¹˜æ•¸è¡¨ X)</option>
            <option value="3">ä¸‰å¹´ç´š (å…©ä½æ•¸åŠ æ³•<50, 30å…§æ¸›æ³•, ä¹˜æ•¸è¡¨ XÃ·)</option>
            <option value="4">å››å¹´ç´š (å…©ä½æ•¸åŠ æ³•<80, 50å…§æ¸›æ³•, ä¹˜æ•¸è¡¨ XÃ·)</option>
            <option value="5">äº”å¹´ç´š (å…©ä½æ•¸åŠ æ³•, 100å…§æ¸›æ³•, ä¹˜æ•¸è¡¨ XÃ·)</option>
            <option value="6">å…­å¹´ç´š (å…©/ä¸‰ä½æ•¸åŠ æ³•, 100å…§æ¸›æ³•, å…©ä½ä¹˜ä¸€ä½ XÃ·)</option>
        </select>

        <label for="modeSelect">é¸æ“‡æ¨¡å¼ï¼š</label>
        <select id="modeSelect">
            <option value="fast">æ¥µé€Ÿå››é¸ä¸€ (5ç§’/é¡Œ, éŒ¯/è¶…æ™‚å³æ­¢)</option>
            <option value="minute">1åˆ†é˜é€Ÿç®— (1åˆ†é˜, éŒ¯æ‰£5ç§’)</option>
        </select>

        <button id="startButton" class="start-btn">é–‹å§‹éŠæˆ²</button>
    </div>

    <div id="gamePanel" class="game-panel">
        <div class="info-bar">
            <span>è¨ˆæ™‚ï¼š<span id="timer">--</span> ç§’</span>
            <span>åˆ†æ•¸ï¼š<span id="score">0</span> é¡Œ</span>
        </div>
        
        <div id="question" class="question">è¼‰å…¥ä¸­...</div>
        
        <div id="options" class="options">
            <button class="option-btn" data-index="0"></button>
            <button class="option-btn" data-index="1"></button>
            <button class="option-btn" data-index="2"></button>
            <button class="option-btn" data-index="3"></button>
        </div>
    </div>

    <div id="resultPanel" class="result-panel">
        <h2>éŠæˆ²çµæŸï¼ğŸ‰</h2>
        <p>ä½ çš„æœ€çµ‚åˆ†æ•¸æ˜¯ï¼š<strong id="finalScore">0</strong> é¡Œ</p>
        <button id="restartButton" class="restart-btn">è¿”å›ä¸»é¸å–®</button>
    </div>
</div>

<script>
    // --- JavaScript é‚è¼¯ ---
    const gradeSelect = document.getElementById('gradeSelect');
    const modeSelect = document.getElementById('modeSelect');
    const startButton = document.getElementById('startButton');
    const selectionPanel = document.getElementById('selectionPanel');
    const gamePanel = document.getElementById('gamePanel');
    const resultPanel = document.getElementById('resultPanel');
    const questionEl = document.getElementById('question');
    const timerEl = document.getElementById('timer');
    const scoreEl = document.getElementById('score');
    const finalScoreEl = document.getElementById('finalScore');
    const optionButtons = document.querySelectorAll('.option-btn');
    const restartButton = document.getElementById('restartButton');

    let currentGrade = 1;
    let currentMode = 'fast';
    let score = 0;
    let fastTimerInterval;
    let minuteTimerInterval;
    let timeLeft = 0;
    let correctAnswer = 0;
    let gameActive = false;

    // --- éŠæˆ²è¨­å®š ---
    const MAX_TIME_FAST = 5;
    const MAX_TIME_MINUTE = 60;
    const WRONG_PENALTY = 5;

    // éš¨æ©Ÿç”Ÿæˆ min (åŒ…å«) å’Œ max (åŒ…å«) ä¹‹é–“çš„æ•´æ•¸
    function rand(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    // æ ¹æ“šå¹´ç´šå’Œé‹ç®—ç¬¦ç”Ÿæˆéš¨æ©Ÿæ•¸å­—ç¯„åœ
    function generateNumbers(op) {
        let num1, num2;
        
        switch (currentGrade) {
            case 1: // ä¸€ä½æ•¸åŠ æ³•å’Œä¸€ä½æ•¸æ¸›æ³•
                if (op === '+') {
                    num1 = rand(1, 9);
                    num2 = rand(1, 9 - num1); // ç¢ºä¿ç­”æ¡ˆåœ¨ 1-9 ç¯„åœ
                } else if (op === '-') {
                    num1 = rand(1, 9);
                    num2 = rand(1, num1);
                }
                break;
            case 2: // 11-20åŠ æ³•å’Œæ¸›æ³•ï¼Œä¹˜æ•¸è¡¨
                if (op === '+') {
                    // ç­”æ¡ˆåœ¨ 11-20 ç¯„åœï¼Œç¢ºä¿ num1, num2 > 0
                    let result = rand(11, 20);
                    num1 = rand(1, result - 1);
                    num2 = result - num1;
                } else if (op === '-') {
                    // è¢«æ¸›æ•¸åœ¨ 11-20 ç¯„åœ
                    num1 = rand(11, 20);
                    num2 = rand(1, num1);
                } else if (op === 'X') {
                    // ä¹˜æ•¸è¡¨
                    num1 = rand(2, 9);
                    num2 = rand(2, 9);
                }
                break;
            case 3: // å…©ä½æ•¸åŠ æ³•ï¼ˆç­”æ¡ˆ50ä»¥ä¸‹ï¼‰ï¼Œ30ä»¥å…§æ¸›æ³•ï¼Œä¹˜æ•¸è¡¨ XÃ·
                if (op === '+') {
                    // ç­”æ¡ˆ 50 ä»¥ä¸‹ï¼Œå…©ä½æ•¸åŠ æ³•
                    let result = rand(20, 50);
                    num1 = rand(10, result - 10);
                    num2 = result - num1;
                } else if (op === '-') {
                    // 30ä»¥å…§æ¸›æ³•
                    num1 = rand(10, 30);
                    num2 = rand(1, num1);
                } else if (op === 'X' || op === 'Ã·') {
                    // ä¹˜æ•¸è¡¨å…§çš„ä¹˜æ³•å’Œé™¤æ³•
                    let divisor = rand(2, 9);
                    let quotient = rand(2, 9);
                    if (op === 'X') {
                        num1 = divisor; num2 = quotient;
                    } else { // 'Ã·'
                        num1 = divisor * quotient;
                        num2 = divisor;
                    }
                }
                break;
            case 4: // å…©ä½æ•¸åŠ æ³•ï¼ˆç­”æ¡ˆ80ä»¥ä¸‹ï¼‰ï¼Œ50ä»¥å…§æ¸›æ³•ï¼Œä¹˜æ•¸è¡¨ XÃ·
                if (op === '+') {
                    // ç­”æ¡ˆ 80 ä»¥ä¸‹ï¼Œå…©ä½æ•¸åŠ æ³•
                    let result = rand(30, 80);
                    num1 = rand(10, result - 10);
                    num2 = result - num1;
                } else if (op === '-') {
                    // 50ä»¥å…§æ¸›æ³•
                    num1 = rand(20, 50);
                    num2 = rand(1, num1);
                } else if (op === 'X' || op === 'Ã·') {
                    // ä¹˜æ•¸è¡¨å…§çš„ä¹˜æ³•å’Œé™¤æ³•
                    let divisor = rand(2, 9);
                    let quotient = rand(2, 12); // æ“´å¤§ä¹˜æ•¸è¡¨ç¯„åœ
                    if (op === 'X') {
                        num1 = divisor; num2 = quotient;
                    } else { // 'Ã·'
                        num1 = divisor * quotient;
                        num2 = divisor;
                    }
                }
                break;
            case 5: // å…©ä½æ•¸åŠ æ³•ï¼Œ100ä»¥å…§æ¸›æ³•ï¼Œä¹˜æ•¸è¡¨ XÃ·
                if (op === '+') {
                    // å…©ä½æ•¸åŠ æ³•ï¼Œç­”æ¡ˆ 100-200 å·¦å³
                    num1 = rand(10, 99);
                    num2 = rand(10, 99);
                } else if (op === '-') {
                    // 100ä»¥å…§æ¸›æ³•
                    num1 = rand(50, 100);
                    num2 = rand(1, num1);
                } else if (op === 'X' || op === 'Ã·') {
                    // ä¹˜æ•¸è¡¨å…§çš„ä¹˜æ³•å’Œé™¤æ³•
                    let divisor = rand(2, 12);
                    let quotient = rand(2, 12);
                    if (op === 'X') {
                        num1 = divisor; num2 = quotient;
                    } else { // 'Ã·'
                        num1 = divisor * quotient;
                        num2 = divisor;
                    }
                }
                break;
            case 6: // å…©æˆ–ä¸‰ä½æ•¸åŠ æ³•ï¼Œ100ä»¥å…§æ¸›æ³•ï¼Œå…©ä½ä¹˜ä¸€ä½çš„ä¹˜æ³•å’Œé™¤æ³•
                if (op === '+') {
                    // å…©æˆ–ä¸‰ä½æ•¸åŠ æ³•
                    num1 = rand(10, 200);
                    num2 = rand(10, 200);
                } else if (op === '-') {
                    // 100ä»¥å…§æ¸›æ³•
                    num1 = rand(50, 100);
                    num2 = rand(1, num1);
                } else if (op === 'X' || op === 'Ã·') {
                    // å…©ä½ä¹˜ä¸€ä½çš„ä¹˜æ³•å’Œé™¤æ³•
                    let singleDigit = rand(2, 9);
                    let doubleDigit = rand(10, 99);
                    if (op === 'X') {
                        num1 = singleDigit; num2 = doubleDigit;
                    } else { // 'Ã·'
                        num1 = singleDigit * doubleDigit;
                        num2 = singleDigit;
                    }
                }
                break;
        }
        return [num1, num2];
    }

    // ç”Ÿæˆé¡Œç›®
    function generateQuestion() {
        let ops = [];
        if (currentGrade === 1) {
            ops = ['+', '-'];
        } else if (currentGrade === 2) {
            ops = ['+', '-', 'X'];
        } else { // 3-6å¹´ç´š
            ops = ['+', '-', 'X', 'Ã·'];
        }

        let op = ops[rand(0, ops.length - 1)];
        let [num1, num2] = generateNumbers(op);
        let result;

        switch (op) {
            case '+': result = num1 + num2; break;
            case '-': result = num1 - num2; break;
            case 'X': result = num1 * num2; break;
            case 'Ã·': result = Math.round(num1 / num2); break;
        }

        correctAnswer = result;
        questionEl.textContent = `${num1} ${op} ${num2} = ?`;
        
        optionButtons.forEach(btn => btn.disabled = false);
        generateOptions(correctAnswer, currentMode);
    }

    // ç”Ÿæˆé¸é … (åŠ å…¥èª˜ç­”é‚è¼¯)
    function generateOptions(correct, mode) {
        let options = new Set([correct]);
        
        if (mode === 'fast') {
            // æ¥µé€Ÿæ¨¡å¼ä½¿ç”¨èª˜ç­”é‚è¼¯
            let distractors = [];
            
            // èª˜ç­” 1: å€‹ä½æ•¸ Â±1
            if (correct % 10 !== 0) distractors.push(correct + 1);
            if (correct % 10 !== 9 && correct > 1) distractors.push(correct - 1);

            // èª˜ç­” 2: åä½æ•¸ Â±10
            if (correct >= 10) {
                if (correct % 100 < 90) distractors.push(correct + 10);
                if (correct > 10) distractors.push(correct - 10);
            }
            
            // ç¯©é¸æœ‰æ•ˆçš„èª˜ç­”ï¼Œä¸¦ç¢ºä¿ä¸é‡è¤‡
            distractors = [...new Set(distractors.filter(d => d > 0 && d !== correct))];
            
            // éš¨æ©Ÿé¸å–èª˜ç­”åŠ å…¥
            while (options.size < 4 && distractors.length > 0) {
                const index = rand(0, distractors.length - 1);
                options.add(distractors[index]);
                distractors.splice(index, 1); // ç§»é™¤å·²é¸çš„èª˜ç­”
            }
        }
        
        // å¦‚æœèª˜ç­”ä¸è¶³ï¼Œå‰‡éš¨æ©Ÿç”Ÿæˆå…¶ä»–ç­”æ¡ˆ
        while (options.size < 4) {
            let offset = rand(2, 15); // éš¨æ©Ÿåç§»é‡
            let wrongAnswer = Math.random() > 0.5 ? correct + offset : correct - offset;

            // ç¢ºä¿ç­”æ¡ˆä¸ç‚ºè² æ•¸ã€ä¸èˆ‡æ­£ç¢ºç­”æ¡ˆé‡è¤‡
            if (wrongAnswer > 0 && wrongAnswer !== correct) {
                 options.add(wrongAnswer);
            }
        }

        let optionsArray = Array.from(options);
        // æ‰“äº‚é¸é …é †åº
        for (let i = optionsArray.length - 1; i > 0; i--) {
            const j = rand(0, i);
            [optionsArray[i], optionsArray[j]] = [optionsArray[j], optionsArray[i]];
        }

        optionButtons.forEach((button, index) => {
            button.textContent = optionsArray[index];
            button.onclick = () => checkAnswer(parseInt(button.textContent));
        });
    }

    // æª¢æŸ¥ç­”æ¡ˆ
    function checkAnswer(selectedAnswer) {
        if (!gameActive) return;

        let isCorrect = selectedAnswer === correctAnswer;
        
        optionButtons.forEach(btn => btn.disabled = true);

        const button = Array.from(optionButtons).find(btn => parseInt(btn.textContent) === selectedAnswer);
        
        const flashClass = isCorrect ? 'correct-flash' : 'wrong-flash';
        if (button) {
            button.classList.add(flashClass);
        }

        setTimeout(() => {
            if (button) {
                button.classList.remove(flashClass);
            }

            if (isCorrect) {
                score++;
                scoreEl.textContent = score;
                if (currentMode === 'fast') {
                    resetFastTimer();
                }
                generateQuestion();
            } else {
                if (currentMode === 'fast') {
                    endGame();
                    return;
                } else if (currentMode === 'minute') {
                    timeLeft -= WRONG_PENALTY;
                    if (timeLeft < 0) {
                        timeLeft = 0;
                    }
                    timerEl.textContent = timeLeft;
                    generateQuestion();
                }
            }

        }, 200);
    }

    // --- æ¥µé€Ÿæ¨¡å¼è¨ˆæ™‚é‚è¼¯ ---
    function startFastTimer() {
        timeLeft = MAX_TIME_FAST;
        timerEl.textContent = timeLeft;
        fastTimerInterval = setInterval(() => {
            timeLeft--;
            timerEl.textContent = timeLeft;
            if (timeLeft <= 0) {
                clearInterval(fastTimerInterval);
                endGame();
            }
        }, 1000);
    }

    function resetFastTimer() {
        clearInterval(fastTimerInterval);
        startFastTimer();
    }

    // --- 1åˆ†é˜æ¨¡å¼è¨ˆæ™‚é‚è¼¯ ---
    function startMinuteTimer() {
        timeLeft = MAX_TIME_MINUTE;
        timerEl.textContent = timeLeft;
        minuteTimerInterval = setInterval(() => {
            timeLeft--;
            timerEl.textContent = timeLeft;
            if (timeLeft <= 0) {
                clearInterval(minuteTimerInterval);
                endGame();
            }
        }, 1000);
    }

    // --- éŠæˆ²æ§åˆ¶ ---
    function startGame() {
        currentGrade = parseInt(gradeSelect.value);
        currentMode = modeSelect.value;
        score = 0;
        scoreEl.textContent = 0;
        gameActive = true;
        
        selectionPanel.style.display = 'none';
        resultPanel.style.display = 'none';
        gamePanel.style.display = 'block';

        timerEl.textContent = currentMode === 'fast' ? MAX_TIME_FAST : MAX_TIME_MINUTE;

        generateQuestion();
        
        if (currentMode === 'fast') {
            startFastTimer();
        } else if (currentMode === 'minute') {
            startMinuteTimer();
        }
    }

    function endGame() {
        gameActive = false;
        clearInterval(fastTimerInterval);
        clearInterval(minuteTimerInterval);
        
        finalScoreEl.textContent = score;
        
        gamePanel.style.display = 'none';
        resultPanel.style.display = 'block';
    }

    function restartGame() {
        selectionPanel.style.display = 'block';
        gamePanel.style.display = 'none';
        resultPanel.style.display = 'none';
        
        clearInterval(fastTimerInterval);
        clearInterval(minuteTimerInterval);
        
        timerEl.textContent = MAX_TIME_FAST;
    }

    // äº‹ä»¶ç›£è½å™¨
    startButton.addEventListener('click', startGame);
    restartButton.addEventListener('click', restartGame);
    
    // åˆå§‹åŒ–æ™‚çš„è¨ˆæ™‚å™¨é¡¯ç¤º
    timerEl.textContent = MAX_TIME_FAST;
</script>

</body>
</html>